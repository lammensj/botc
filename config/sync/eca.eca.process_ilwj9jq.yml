uuid: 785e6d44-5fba-4384-8d97-4ff57a8d6366
langcode: en
status: true
dependencies:
  module:
    - citadel_eca
    - discord_php_eca
    - eca_base
    - eca_log
    - eca_tamper
id: process_ilwj9jq
modeller: bpmn_io
label: DiscordPHP
version: 1.0.0
weight: null
events:
  Event_0zlafqh:
    plugin: 'discord_php_eca:ready'
    label: 'DiscordPHP is ready'
    configuration: {  }
    successors:
      -
        id: Activity_09u70l7
        condition: ''
  Event_0s3wt07:
    plugin: 'discord_php_eca:message_create'
    label: 'Message received'
    configuration: {  }
    successors:
      -
        id: Activity_0mszrs9
        condition: Flow_0uq7dxy
      -
        id: Activity_0r4qsv3
        condition: Flow_0z03gml
  Event_01lo1pu:
    plugin: 'eca_base:eca_custom'
    label: Event_01lo1pu
    configuration:
      event_id: drush
    successors:
      -
        id: Activity_15zojwg
        condition: ''
conditions:
  Flow_0uq7dxy:
    plugin: eca_scalar
    configuration:
      negate: false
      left: '[message:content]'
      right: image
      operator: equal
      type: value
      case: true
  Flow_0z03gml:
    plugin: eca_scalar
    configuration:
      negate: false
      left: '[message:content]'
      right: /drush
      operator: beginswith
      type: value
      case: true
  Flow_15kxtsd:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[command_is_successful]'
      right: '1'
      operator: equal
      type: value
  Flow_0x94ue8:
    plugin: eca_scalar
    configuration:
      negate: false
      case: false
      left: '[command_is_successful]'
      right: 'false'
      operator: equal
      type: value
gateways: {  }
actions:
  Activity_0m3u1zp:
    plugin: discord_php_eca_send_message
    label: Reply
    configuration:
      content: '[drush_output]'
      channel_id: '[message:channel_id]'
      reply_to_id: '[message:id]'
      reply_to_channel_id: '[message:channel_id]'
      filepath: ''
    successors: {  }
  Activity_0mszrs9:
    plugin: discord_php_eca_send_message
    label: 'Reply with img'
    configuration:
      content: Image
      channel_id: '[message:channel_id]'
      reply_to_id: '[message:id]'
      reply_to_channel_id: '[message:channel_id]'
      filepath: 'public://76855592.png'
    successors: {  }
  Activity_09u70l7:
    plugin: eca_write_log_message
    label: Log
    configuration:
      channel: discord_php
      severity: '7'
      message: 'DiscordPHP is ready.'
    successors: {  }
  Activity_1pb917l:
    plugin: citadel_exa_execute_drush_command
    label: drush
    configuration:
      command: '[drush_command]'
      output_token_name: command_output
    successors:
      -
        id: Activity_0nawmt3
        condition: ''
  Activity_0kcl9ea:
    plugin: eca_write_log_message
    label: Log
    configuration:
      channel: eca
      severity: '7'
      message: '[command_output]'
    successors: {  }
  Activity_15zojwg:
    plugin: eca_token_set_value
    label: 'Set command'
    configuration:
      token_name: drush_command
      token_value: 'hems:schedule -a 150W:4 -a 10W:6'
      use_yaml: false
    successors:
      -
        id: Activity_1bna7om
        condition: ''
  Activity_0r4qsv3:
    plugin: 'eca_tamper:find_replace_regex'
    label: 'Set command'
    configuration:
      find: '/(\/drush )/'
      replace: ''
      limit: ''
      eca_data: '[message:content]'
      eca_token_name: drush_command
    successors:
      -
        id: Activity_0fvjh7d
        condition: ''
  Activity_04bcpzc:
    plugin: citadel_exa_execute_drush_command
    label: drush
    configuration:
      command: '[drush_command]'
      output_token_name: drush_output
    successors:
      -
        id: Activity_0etxew5
        condition: ''
  Activity_0etxew5:
    plugin: 'eca_tamper:truncate_text'
    label: 'Truncate output'
    configuration:
      num_char: '1997'
      ellipses: 1
      wordsafe: false
      eca_data: '[drush_output]'
      eca_token_name: drush_output
    successors:
      -
        id: Activity_0woavtj
        condition: ''
  Activity_0fvjh7d:
    plugin: 'eca_tamper:explode'
    label: 'Explode arguments'
    configuration:
      separator: '%s'
      limit: ''
      eca_data: '[drush_command]'
      eca_token_name: drush_command
    successors:
      -
        id: Activity_04bcpzc
        condition: ''
  Activity_1bna7om:
    plugin: 'eca_tamper:explode'
    label: 'Explode arguments'
    configuration:
      separator: '%s'
      limit: ''
      eca_data: '[drush_command]'
      eca_token_name: drush_command
    successors:
      -
        id: Activity_1pb917l
        condition: ''
  Activity_0nawmt3:
    plugin: 'eca_tamper:truncate_text'
    label: 'Truncate output'
    configuration:
      num_char: '1997'
      ellipses: 1
      wordsafe: false
      eca_data: '[command_output]'
      eca_token_name: command_output
    successors:
      -
        id: Activity_0kcl9ea
        condition: ''
      -
        id: Activity_0cl2c5q
        condition: ''
  Activity_0cl2c5q:
    plugin: action_message_action
    label: Message
    configuration:
      message: '[command_output]'
      replace_tokens: true
    successors: {  }
  Activity_1uiqpar:
    plugin: discord_php_eca_send_message
    label: Reply
    configuration:
      content: 'Error: [drush_output]'
      channel_id: '[message:channel_id]'
      reply_to_id: '[message:id]'
      reply_to_channel_id: '[message:channel_id]'
      filepath: ''
    successors: {  }
  Activity_1avkr69:
    plugin: 'eca_tamper:truncate_text'
    label: 'Truncate output'
    configuration:
      num_char: '1993'
      ellipses: 1
      wordsafe: false
      eca_data: '[drush_output]'
      eca_token_name: drush_output
    successors:
      -
        id: Activity_1uiqpar
        condition: ''
  Activity_0woavtj:
    plugin: 'eca_tamper:convert_boolean'
    label: 'Convert isSuccessful to bool'
    configuration:
      true_value: '1'
      false_value: ''
      match_case: false
      no_match_value: false
      eca_data: '[command_is_successful]'
      eca_token_name: command_is_successful
      other_text: ''
    successors:
      -
        id: Activity_0m3u1zp
        condition: Flow_15kxtsd
      -
        id: Activity_1avkr69
        condition: Flow_0x94ue8
